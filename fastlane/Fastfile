default_platform(:ios)

platform :ios do
  desc "Run tests and build verification"
  lane :test do
    # Xcode 26.1 í™˜ê²½ì— ë§ì¶° ì‹¤í–‰
    
    # ê¸°ë³¸ì ìœ¼ë¡œ Debug ë¹Œë“œëŠ” í•­ìƒ ê²€ì¦
    configs_to_test = ["Debug"]

    # main ë¸Œëœì¹˜ì¸ ê²½ìš°ì—ë§Œ Release ë¹Œë“œê¹Œì§€ ì¶”ê°€ ê²€ì¦
    current_branch = git_branch
    if current_branch == "main" || ENV["GITHUB_REF_NAME"] == "main"
      configs_to_test << "Release"
    end

    configs_to_test.each do |config|
      puts "ğŸš€ Testing #{config} build..."
      scan(
        project: "./Damago/Damago.xcodeproj",
        scheme: "Damago",
        configuration: config,
        devices: ["iPhone 16 Pro"], # í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ìµœì‹  ê¸°ì¢… ì‹œë®¬ë ˆì´í„° ì§€ì •
        clean: true,
        # CI í™˜ê²½ì—ì„œ SwiftLint ë“± ë¹Œë“œ íˆ´ í”ŒëŸ¬ê·¸ì¸ ì‹ ë¢° ë¬¸ì œ í•´ê²°
        xcargs: "-skipPackagePluginValidation"
      )
    end
  end
end
