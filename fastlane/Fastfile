default_platform(:ios)

platform :ios do
  desc "Run tests and build verification"
  lane :test do
    # Xcode 26.1 í™˜ê²½ì— ë§ì¶° ì‹¤í–‰
    
    # ê¸°ë³¸ì ìœ¼ë¡œ Debug ë¹Œë“œëŠ” í•­ìƒ ê²€ì¦
    configs_to_test = ["Debug"]

    # main ë¸Œëœì¹˜ì¸ ê²½ìš°ì—ë§Œ Release ë¹Œë“œê¹Œì§€ ì¶”ê°€ ê²€ì¦
    current_branch = git_branch
    if current_branch == "main" || ENV["GITHUB_REF_NAME"] == "main"
      configs_to_test << "Release"
    end

    configs_to_test.each do |config|
      puts "ğŸš€ Validating #{config} build..."
      xcodebuild(
        build: true,
        project: "./Damago/Damago.xcodeproj",
        scheme: "Damago",
        configuration: config,
        destination: "generic/platform=iOS Simulator", # íŠ¹ì • ì‹œë®¬ë ˆì´í„°ê°€ ì•„ë‹Œ ì¼ë°˜ì ì¸ ì‹œë®¬ë ˆì´í„° ì‚¬ìš©
        clean: true,
        # CI í™˜ê²½ì—ì„œ SwiftLint ë“± ë¹Œë“œ íˆ´ í”ŒëŸ¬ê·¸ì¸ ì‹ ë¢° ë¬¸ì œ í•´ê²°
        xcargs: "-skipPackagePluginValidation"
      )
    end
  end
end
