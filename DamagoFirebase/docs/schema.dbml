Table users {
  udid varchar [pk, note: "기기 고유 식별자"]
  code varchar [unique, note: "커플 연결 시 사용되는 임시 코드"]
  
  // 관계 조회 비용(Read)을 줄이기 위해 파트너, 다마고, 기념일 정보를 직접 참조합니다.
  partnerUDID varchar [ref: - users.udid, note: "연결된 파트너의 UDID"]
  damagoID varchar [ref: > damagos.id, note: "공유 중인 다마고 문서 ID"]
  coupleID varchar [ref: > couples.id, note: "커플 관계 ID"]
  anniversaryDate timestamp [note: "커플 기념일"]

  // --- Profile ---
  nickname varchar [note: "사용자 닉네임"]

  // --- Push & Live Activity Tokens ---
  fcmToken text [note: "일반 푸시 알림용 FCM 토큰"]
  laStartToken text [note: "Live Activity 원격 시작용 토큰 (iOS 17.2+)"]
  laUpdateToken text [note: "실행 중인 Live Activity 업데이트용 토큰"]
  
  // 토큰 조회 시 이 값들을 함께 확인하여, False일 경우 APNs 요청을 보내지 않아 비용을 절감합니다.
  useFCM boolean [default: true, note: "앱 내 일반 알림 수신 여부"]
  useLiveActivity boolean [default: true, note: "Live Activity 업데이트 수신 여부"]

  createdAt timestamp [default: `now()`]
  updatedAt timestamp [note: "최종 정보 수정 시각"]
  
  Note: "개별 사용자 정보와 푸시 토큰, 그리고 앱 설정값을 저장합니다."
}

Table couples {
  id varchar [pk, note: "커플 고유 ID (Firestore Auto-ID)"]
  user1UDID varchar [ref: > users.udid, note: "사용자 1"]
  user2UDID varchar [ref: > users.udid, note: "사용자 2"]
  damagoID varchar [ref: > damagos.id, note: "커플이 소유한 다마고 ID"]
  
  anniversaryDate timestamp [note: "기념일 원본 데이터"]
  createdAt timestamp [default: `now()`]
  
  Note: "두 사용자의 관계 및 기념일 원본을 저장합니다."
}

Table damagos {
  id varchar [pk, note: "다마고 고유 ID (Firestore Auto-ID)"]
  coupleID varchar [ref: > couples.id, unique, note: "소유주 커플 ID"]
  
  // --- 고정 속성 (Static Attributes) ---
  petName varchar [note: "펫 이름"]
  
  // --- 동적 상태 (Dynamic ContentState) ---
  characterName varchar [note: "캐릭터 종류"]
  isHungry boolean [default: false, note: "배고픔 상태"]
  statusMessage text [note: "상태 메시지"]

  lastFedAt timestamp [note: "마지막으로 밥을 먹은 시각"]
  lastUpdatedAt timestamp [note: "상태 최종 업데이트 시각"]
  
  Note: "커플이 공유하는 다마고의 상태 정보입니다. 서버가 이 데이터를 수정하면 연결된 유저들에게 알림이 전송됩니다."
}
